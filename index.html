<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Builder Pro</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.12.1/font/bootstrap-icons.min.css">
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            color: white !important;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .nav-link {
            color: rgba(255,255,255,0.9) !important;
            transition: color 0.3s ease;
        }

        .nav-link:hover {
            color: white !important;
        }

        .navbar-toggler {
            border-color: rgba(255,255,255,0.5);
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 2rem 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .form-section, .preview-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-control {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 0.75rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .btn-primary {
            background-color: var(--accent-color);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
        }

        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        /* Footer Styles */
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            margin-top: auto;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-links a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 1rem;
        }

        .social-links a {
            color: white;
            font-size: 1.5rem;
            transition: opacity 0.3s ease;
        }

        .social-links a:hover {
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                text-align: center;
            }

            .footer-links {
                justify-content: center;
            }

            .social-links {
                justify-content: center;
            }
        }

        /* Existing styles... */
        .contact-info {
            font-size: 0.95rem;
        }
        .contact-info i {
            width: 20px;
            text-align: center;
        }
        .contact-info span {
            color: var(--secondary-color);
        }

        .skills-list, .languages-list {
            font-size: 0.95rem;
        }
        .skill-item, .language-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }
        .skill-item:before {
            content: "•";
            color: var(--accent-color);
            font-weight: bold;
            margin-right: 0.5rem;
        }
        .language-item {
            justify-content: space-between;
        }
        .language-level {
            font-size: 0.85rem;
            color: var(--accent-color);
            font-weight: 500;
        }
    </style>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-file-earmark-text me-2"></i>
                CV Builder Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="bi bi-house-door me-1"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-question-circle me-1"></i>Help</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-info-circle me-1"></i>About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="row g-4">
                <!-- Form Section -->
                <div class="col-lg-5">
                    <div class="form-section">
                        <h2 class="section-title">CV Builder</h2>
                        
                        <!-- Personal Information -->
                        <div class="mb-4">
                            <h4 class="h5 mb-3">Personal Information</h4>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="text" id="lastNameInput" class="form-control" placeholder="Last name">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" id="firstNameInput" class="form-control" placeholder="First name">
                                </div>
                            </div>
                            <input type="text" id="specialityInput" class="form-control" placeholder="Speciality">
                            <textarea id="descriptionInput" class="form-control" placeholder="Description" rows="3"></textarea>
                        </div>

                        <!-- Contact Information -->
                        <div class="mb-4">
                            <h4 class="h5 mb-3">Contact Information</h4>
                            <div class="mb-3">
                                <label class="form-label">Profile Image</label>
                                <input type="file" class="form-control" id="profileImage" accept="image/*">
                            </div>
                            <input type="email" id="gmailInput" class="form-control" placeholder="Email">
                            <input type="text" id="addressInput" class="form-control" placeholder="Address">
                            <input type="tel" id="telInput" class="form-control" placeholder="Phone">
                        </div>

                        <!-- Skills -->
                        <div class="mb-4">
                            <h4 class="h5 mb-3">Skills & Languages</h4>
                            <div class="mb-3">
                                <div class="input-group">
                                    <input type="text" id="skillInput" class="form-control" placeholder="Add a skill">
                                    <button class="btn btn-primary" id="addSkill">
                                        <i class="bi bi-plus-circle me-1"></i>Add
                                    </button>
                                </div>
                                <div id="skillsList" class="mt-3">
                                    <!-- Skills will be added here -->
                                </div>
                            </div>
                            <div class="mb-3">
                                <h5 class="h6 mb-2">Languages</h5>
                                <div class="input-group">
                                    <input type="text" id="languageInput" class="form-control" placeholder="Language">
                                    <select class="form-select" id="languageLevel" style="max-width: 150px;">
                                        <option value="Beginner">Beginner</option>
                                        <option value="Intermediate">Intermediate</option>
                                        <option value="Advanced">Advanced</option>
                                        <option value="Native">Native</option>
                                    </select>
                                    <button class="btn btn-primary" id="addLanguage">
                                        <i class="bi bi-plus-circle me-1"></i>Add
                                    </button>
                                </div>
                                <div id="languagesList" class="mt-3">
                                    <!-- Languages will be added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Education -->
                        <div class="mb-4">
                            <h4 class="h5 mb-3">Education</h4>
                            <div id="mesFormations" class="mb-3">
                                <!-- Formations will be added here -->
                            </div>
                            <div class="row g-3">
                                <div class="col-12">
                                    <input type="text" id="formationInput" class="form-control" placeholder="Degree/Formation">
                                </div>
                                <div class="col-12">
                                    <input type="text" id="faculteInput" class="form-control" placeholder="Institution">
                                </div>
                                <div class="col-12">
                                    <input type="date" id="dateInput" class="form-control">
                                </div>
                                <div class="col-12">
                                    <button id="add" class="btn btn-primary w-100">
                                        <i class="bi bi-plus-circle me-2"></i>Add Education
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Generate PDF Button -->
                        <button type="button" class="btn btn-primary w-100" onclick="genererPDF()">
                            <i class="bi bi-file-pdf me-2"></i>Generate PDF
                        </button>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="col-lg-7">
                    <div class="preview-section">
                        <div id="monCvHTML">
                            <div class="row">
                                <!-- Left Column -->
                                <div class="col-md-4">
                                    <div class="text-center mb-4">
                                        <img id="previewImage" src="assets/img/Capture12.PNG" class="img-thumbnail rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                                    </div>
                                    
                                    <h5 class="section-title">CONTACT</h5>
                                    <div class="contact-info">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-telephone-fill me-2 text-primary"></i>
                                            <span id="tel"></span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-envelope-fill me-2 text-primary"></i>
                                            <span id="gmail"></span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-geo-alt-fill me-2 text-primary"></i>
                                            <span id="address"></span>
                                        </div>
                                    </div>

                                    <h5 class="section-title">SKILLS</h5>
                                    <div class="skills-list">
                                        <div id="competence" class="mb-3"></div>
                                    </div>

                                    <h5 class="section-title">LANGUAGES</h5>
                                    <div class="languages-list">
                                        <div id="languages" class="mb-3"></div>
                                    </div>
                                </div>

                                <!-- Right Column -->
                                <div class="col-md-8">
                                    <div class="mb-4">
                                        <h1 class="mb-2">
                                            <span id="myLastName" class="text-capitalize"></span>
                                            <span id="myFirstName" class="text-uppercase d-block"></span>
                                        </h1>
                                        <p id="speciality" class="text-uppercase text-muted mb-3"></p>
                                        <p id="description" class="mb-4"></p>
                                    </div>

                                    <h5 class="section-title">EDUCATION</h5>
                                    <div id="listFormationsHTML" class="mb-4">
                                        <!-- Education items will be added here -->
                                    </div>

                                    <h5 class="section-title">PROFESSIONAL EXPERIENCE</h5>
                                    <div id="experienceList">
                                        <!-- Experience items will be added here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="copyright">
                    © 2024 CV Builder Pro. All rights reserved.
                </div>
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Contact Us</a>
                </div>
                <div class="social-links">
                    <a href="#" title="Facebook"><i class="bi bi-facebook"></i></a>
                    <a href="#" title="Twitter"><i class="bi bi-twitter"></i></a>
                    <a href="#" title="LinkedIn"><i class="bi bi-linkedin"></i></a>
                    <a href="#" title="GitHub"><i class="bi bi-github"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const formations = [];
        let listFormations = document.getElementById("mesFormations");
        let listFormationsHTML = document.getElementById("listFormationsHTML");

        // Add image preview functionality
        document.getElementById('profileImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImage').src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        // Update the addFormation function
        function addFormation() {
            const pFormation = document.getElementById('formationInput').value.trim();
            const sFormation = document.getElementById('faculteInput').value.trim();
            const dFormation = document.getElementById('dateInput').value;

            if (!pFormation || !sFormation || !dFormation) {
                showToast("Please fill all education fields", "error");
                return;
            }

            formations.push({pFormation, sFormation, dFormation});

            // Create formation item for the form list
            const formationItem = document.createElement("div");
            formationItem.className = "card mb-3";
            formationItem.innerHTML = `
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="card-title mb-1">${pFormation}</h6>
                            <p class="card-text text-muted mb-1">${sFormation}</p>
                            <small class="text-muted">${formatDate(dFormation)}</small>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-primary edit-formation">
                                <i class="bi bi-pencil-fill"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-formation">
                                <i class="bi bi-trash-fill"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('mesFormations').appendChild(formationItem);

            // Add event listeners for edit and delete buttons
            formationItem.querySelector('.edit-formation').addEventListener('click', function() {
                document.getElementById('formationInput').value = pFormation;
                document.getElementById('faculteInput').value = sFormation;
                document.getElementById('dateInput').value = dFormation;
                formationItem.remove();
                const index = formations.findIndex(f => 
                    f.pFormation === pFormation && 
                    f.sFormation === sFormation && 
                    f.dFormation === dFormation
                );
                if (index !== -1) {
                    formations.splice(index, 1);
                }
            });

            formationItem.querySelector('.delete-formation').addEventListener('click', function() {
                if (confirm('Are you sure you want to delete this education entry?')) {
                    formationItem.remove();
                    const index = formations.findIndex(f => 
                        f.pFormation === pFormation && 
                        f.sFormation === sFormation && 
                        f.dFormation === dFormation
                    );
                    if (index !== -1) {
                        formations.splice(index, 1);
                    }
                    showToast("Education entry deleted", "success");
                }
            });

            // Clear inputs
            document.getElementById('formationInput').value = "";
            document.getElementById('faculteInput').value = "";
            document.getElementById('dateInput').value = "";

            showToast("Education added successfully", "success");
        }

        // Helper function to format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Helper function to show toast messages
        function showToast(message, type = "success") {
            const styles = {
                success: "linear-gradient(to right, #00b09b, #96c93d)",
                error: "linear-gradient(to right, #ff5f6d, #ffc371)",
                info: "linear-gradient(to right, #2193b0, #6dd5ed)"
            };

            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                className: type,
                style: {
                    background: styles[type],
                    borderRadius: "5px",
                    fontWeight: "500"
                }
            }).showToast();
        }

        // Skills and Languages Management
        const skills = [];
        const languages = [];

        // Add Skill
        document.getElementById('addSkill').addEventListener('click', function() {
            const skillInput = document.getElementById('skillInput');
            const skill = skillInput.value.trim();
            
            if (skill) {
                if (!skills.includes(skill)) {
                    skills.push(skill);
                    updateSkillsList();
                    skillInput.value = '';
                    showToast("Skill added successfully", "success");
                } else {
                    showToast("This skill already exists", "error");
                }
            } else {
                showToast("Please enter a skill", "error");
            }
        });

        // Add Language
        document.getElementById('addLanguage').addEventListener('click', function() {
            const languageInput = document.getElementById('languageInput');
            const levelSelect = document.getElementById('languageLevel');
            const language = languageInput.value.trim();
            const level = levelSelect.value;
            
            if (language) {
                const languageObj = { language, level };
                if (!languages.some(l => l.language === language)) {
                    languages.push(languageObj);
                    updateLanguagesList();
                    languageInput.value = '';
                    showToast("Language added successfully", "success");
                } else {
                    showToast("This language already exists", "error");
                }
            } else {
                showToast("Please enter a language", "error");
            }
        });

        // Update Skills List
        function updateSkillsList() {
            const skillsList = document.getElementById('skillsList');
            skillsList.innerHTML = '';
            
            skills.forEach((skill, index) => {
                const skillItem = document.createElement('div');
                skillItem.className = 'card mb-2';
                skillItem.innerHTML = `
                    <div class="card-body py-2 px-3 d-flex justify-content-between align-items-center">
                        <span>${skill}</span>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-danger delete-skill" data-index="${index}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                skillsList.appendChild(skillItem);
            });

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-skill').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    skills.splice(index, 1);
                    updateSkillsList();
                    showToast("Skill removed", "success");
                });
            });
        }

        // Update Languages List
        function updateLanguagesList() {
            const languagesList = document.getElementById('languagesList');
            languagesList.innerHTML = '';
            
            languages.forEach((lang, index) => {
                const languageItem = document.createElement('div');
                languageItem.className = 'card mb-2';
                languageItem.innerHTML = `
                    <div class="card-body py-2 px-3 d-flex justify-content-between align-items-center">
                        <div>
                            <span class="fw-bold">${lang.language}</span>
                            <span class="badge bg-primary ms-2">${lang.level}</span>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-danger delete-language" data-index="${index}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                languagesList.appendChild(languageItem);
            });

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-language').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    languages.splice(index, 1);
                    updateLanguagesList();
                    showToast("Language removed", "success");
                });
            });
        }

        // Update the PDF generation function
        function genererPDF() {
            // Validate required fields
            const requiredFields = {
                lastName: "Last name",
                firstName: "First name",
                speciality: "Speciality",
                description: "Description",
                gmail: "Email",
                tel: "Phone"
            };

            console.log("Starting PDF generation...");

            for (const [id, label] of Object.entries(requiredFields)) {
                const value = document.getElementById(id+"Input").value.trim();
                if (!value) {
                    showToast(`Please fill in your ${label}`, "error");
                    return;
                }
            }

            // Update preview with form values
            const formData = {
                lastName: document.getElementById('lastNameInput').value.trim(),
                firstName: document.getElementById('firstNameInput').value.trim(),
                speciality: document.getElementById('specialityInput').value.trim(),
                description: document.getElementById('descriptionInput').value.trim(),
                gmail: document.getElementById('gmailInput').value.trim(),
                address: document.getElementById('addressInput').value.trim(),
                tel: document.getElementById('telInput').value.trim(),
                competence: skills.join('\n'),
                langage: languages.map(lang => `${lang.language} - ${lang.level}`).join('\n')
            };

            // Update preview elements
            Object.keys(formData).forEach(key => {
                const element = document.getElementById(key === 'langage' ? 'languages' : key);
                if (element) {
                    element.textContent = formData[key];
                }
            });

            // Update name elements
            document.getElementById('myLastName').textContent = formData.lastName;
            document.getElementById('myFirstName').textContent = formData.firstName;
            document.getElementById('speciality').textContent = formData.speciality;
            document.getElementById('description').textContent = formData.description;

            // Update education section
            const educationList = document.getElementById('listFormationsHTML');
            educationList.innerHTML = '';
            formations.forEach(formation => {
                const educationItem = document.createElement('div');
                educationItem.className = 'mb-3';
                educationItem.innerHTML = `
                    <h6 class="mb-1">${formation.pFormation}</h6>
                    <p class="text-muted mb-1">${formation.sFormation}</p>
                    <small>${formatDate(formation.dFormation)}</small>
                `;
                educationList.appendChild(educationItem);
            });

            // Update skills display
            const competenceElement = document.getElementById('competence');
            competenceElement.innerHTML = skills.map(skill => 
                `<div class="skill-item">${skill}</div>`
            ).join('');

            // Update languages display
            const languagesElement = document.getElementById('languages');
            languagesElement.innerHTML = languages.map(lang => 
                `<div class="language-item">
                    <span>${lang.language}</span>
                    <span class="language-level">${lang.level}</span>
                </div>`
            ).join('');

            // Show loading toast
            showToast("Generating PDF...", "info");

            // Get the element to convert
            const element = document.getElementById('monCvHTML');
            
            // Store original styles
            const originalStyles = {
                width: element.style.width,
                height: element.style.height,
                transform: element.style.transform,
                position: element.style.position,
                padding: element.style.padding,
                margin: element.style.margin,
                backgroundColor: element.style.backgroundColor
            };

            // Set styles for PDF generation
            Object.assign(element.style, {
                width: '210mm',
                height: 'auto',
                transform: 'none',
                position: 'relative',
                backgroundColor: '#ffffff',
                padding: '20mm',
                margin: '0',
                boxShadow: 'none',
                borderRadius: '0'
            });

            // Ensure all text is visible
            const textElements = element.getElementsByTagName('*');
            for (let i = 0; i < textElements.length; i++) {
                const style = window.getComputedStyle(textElements[i]);
                if (style.color === 'rgba(0, 0, 0, 0)') {
                    textElements[i].style.color = '#000000';
                }
            }

            // Generate PDF
            html2canvas(element, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                logging: true,
                windowWidth: element.scrollWidth,
                windowHeight: element.scrollHeight,
                onclone: function(clonedDoc) {
                    // Ensure all images are loaded in the cloned document
                    const images = clonedDoc.getElementsByTagName('img');
                    for (let i = 0; i < images.length; i++) {
                        if (!images[i].complete) {
                            images[i].src = images[i].src;
                        }
                    }
                }
            }).then(canvas => {
                // Restore original styles
                Object.assign(element.style, originalStyles);

                try {
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const { jsPDF } = window.jspdf;
                    
                    // Create PDF with proper orientation
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });

                    // Calculate dimensions
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    
                    // Calculate scaling to fit the page while maintaining aspect ratio
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    const scaledWidth = imgWidth * ratio;
                    const scaledHeight = imgHeight * ratio;
                    
                    // Center the content
                    const x = (pdfWidth - scaledWidth) / 2;
                    const y = 0;

                    // Add the image to the PDF
                    pdf.addImage(imgData, 'JPEG', x, y, scaledWidth, scaledHeight);

                    // If content is too long, add new pages
                    if (scaledHeight > pdfHeight) {
                        const pageCount = Math.ceil(scaledHeight / pdfHeight);
                        for (let i = 1; i < pageCount; i++) {
                            pdf.addPage();
                            pdf.addImage(
                                imgData,
                                'JPEG',
                                x,
                                -(pdfHeight * i),
                                scaledWidth,
                                scaledHeight
                            );
                        }
                    }

                    // Save the PDF
                    pdf.save('CV.pdf');
                    showToast("PDF generated successfully", "success");
                } catch (error) {
                    console.error("Error creating PDF:", error);
                    showToast("Error creating PDF. Please try again.", "error");
                    // Restore original styles in case of error
                    Object.assign(element.style, originalStyles);
                }
            }).catch(error => {
                console.error("Error generating canvas:", error);
                showToast("Error generating PDF. Please try again.", "error");
                // Restore original styles in case of error
                Object.assign(element.style, originalStyles);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('add').addEventListener('click', addFormation);
            
            // Add input validation
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    this.classList.toggle('is-invalid', !this.value.trim());
                });
            });
        });

        // Add keyboard support for adding skills and languages
        document.getElementById('skillInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('addSkill').click();
            }
        });

        document.getElementById('languageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('addLanguage').click();
            }
        });
    </script>
</body>
</html>